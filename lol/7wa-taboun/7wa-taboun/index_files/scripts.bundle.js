cssNamespace.pkportal.restService=function(e){"use strict";function n(e,n,t,o){p=e,m=n,h=t,v=o}function t(e,n){var t=n?p:m;return t+"/kuzu/v1/"+e}function o(){return"undefined"==typeof f&&(f=new Promise(function(n,t){var o={type:"GET",url:e.configureServletUrl(h),success:n,error:t};e.doPost(o)})),f}function r(){return $.cookie(v)?Promise.resolve():o()}function i(){return $.cookie(v)}function a(e,n,o,r){return s(t(e,!0),n,o,r,!0)}function u(e,n,o,r){return s(t(e,!1),n,o,r,!0)}function c(e,n,t,o){return s(p+e,n,t,o,!0)}function l(e,n,t,o){return s(e,n,t,o,!1)}function d(e,n,t,o){return s(e,n,t,o,!0)}function s(n,t,o,a,u){t=t||"GET";var c=e.getLanguage(window.location.href),l=c.longCode,d=a||{},s="undefined"!=typeof d.processData&&d.processData,f="undefined"!=typeof d.contentType&&d.contentType,p="undefined"==typeof d.headersAccept?"application/json":d.headersAccept,m="undefined"==typeof d.headersAcceptLanguage?l:d.headersAcceptLanguage,h="undefined"==typeof d.dataType?"":d.dataType,v="undefined"!=typeof d.returnHeader&&d.returnHeader;return new Promise(function(a,c){r().then(function(){var r={headers:{Accept:p,"Accept-Language":m},dataType:h,omitCharset:!0,contentType:f,processData:s,type:t,data:o,url:n,success:a,error:c,cache:!1};u&&(r.headers.Authorization="Bearer "+i()),f&&(r.headers["Content-Type"]=f),v&&(r.success=function(e,n,t){a({data:e,textStatus:n,jqXHR:t})}),e.doPost(r)},function(e){return!1})["catch"](function(e){return!1})})}var f,p="",m="",h="",v="";return{init:n,getApiUrl:t,doRestApiCall:a,doRestApiCallWithoutMandant:u,doExternalRestApiCall:l,doUrlRestApiCall:d,doNonKuzuRestApiCall:c}}(cssNamespace.pkportal.utils),cssNamespace.pkportal.restFileUpload=function(e,n){"use strict";function t(n){e.extend(G,a(n)),G.restrictToOneUpload?(c("onFirstFileAdded",F),c("onLastFileRemoved",g)):G.maxFileNumber>0&&(c("onFileAdded",A),c("onFileRemoved",A)),_=!0}function o(e,n){if(!_)throw new Error("can not init component before it is configured");if(!n)throw new Error("can not init component without url");G.uploadUrl=n,R(e),E(e)}function r(n){n=e(n);var t=n.parent(".fileEntry");n.off("click.fileupload"),w(t),p(l(t)).filecount--}function i(n,t,o,i){var a=Math.round(t/1024),c=n+" ("+a+" KB)",l=e("<div/>",{"class":"fileEntry"});e("<div/>",{"class":"removeFile",alt:G.labelRemove,title:G.labelRemove}).on("click.fileupload",function(){r(e(this),e(this).parents(".fileUploadContainer"))}).appendTo(l),e("<input/>",{name:"fileupload_name",type:"hidden",value:n}).appendTo(l),e("<input/>",{name:"fileupload_size",type:"hidden",value:t}).appendTo(l),e("<input/>",{name:"fileupload_uuid",type:"hidden",value:o}).appendTo(l),e("<span/>",{"class":"fileinfo"}).text(c).appendTo(l);var d=k(i),s=f(i);s.append(l),p(i).filecount++,d&&u("onFirstFileAdded",i),P(i),u("onFileAdded",i)}function a(n){return e.isNumeric(n.maxFileNumber)||delete n.maxFileNumber,e.isNumeric(n.maxUploadSize)||delete n.maxUploadSize,n}function u(n,t){for(var o=K[n],r=0;r<o.length;r++)e.isFunction(o[r])&&o[r](t)}function c(e,n){var t=K[e];if(!t)throw new Error("event handler "+e+" not supported");t.push(n)}function l(n){return e(n).closest(".fileuploadComponent")}function d(e){return e.find(".fileUploadContainer")}function s(e){return e.find(".attachDocument")}function f(e){return e.find(".filelist")}function p(e){return d(e).data()}function m(e){return e.find(".filechooser")}function h(e){e.find(".uploadErrorMessage").empty().hide()}function v(e){d(e).hide()}function y(e){d(e).show()}function g(e){s(e).show()}function F(e){s(e).hide()}function w(n){var t=l(n);n.fadeOut(500,function(){e(this).remove(),k(t)&&u("onLastFileRemoved",t),u("onFileRemoved",t)}),h(t)}function A(e){p(e).filecount>=G.maxFileNumber?F(e):g(e)}function T(e){s(e).attr("disabled","disabled")}function x(e){s(e).removeAttr("disabled")}function R(e){var n=m(e);n.on("click",function(){var e=l(this);h(e)}),n.on("change",function(e){var n=l(this);U(n,e.target.files)})}function U(e,n){var t=[];T(e);for(var o=0;o<n.length;o++){var r=n[o];b(r,e)&&(t[o]=N(r).then(function(n){n?i(n.name,n.size,n.uuid,e):I(e)},function(){I(e)}))}t.length&&Promise.all(t).then(function(){z(e),x(e)})}function b(e,n){var t=!0;return L(e.name)||(t=!1,O(n)),S(e.size)||(t=!1,B(n)),D(n)||(t=!1,H(n)),t}function N(e){return C(e).then(function(t){var o=encodeURI(G.uploadUrl)+"?mimeType="+encodeURIComponent(e.type)+"&fileName="+encodeURI(e.name),r="data:"+e.type+";base64,",i=t.substring(r.length),a=atob(i),u=M(a),c=new FormData,l=new Blob([u],{type:e.type});return c.append("file",l,e.name),n.doRestApiCall(o,"POST",c,{processData:!1}).then(function(n){return(!n||!n.error)&&{uuid:n,name:e.name,size:e.size}},function(){return!1})})}function C(e){return new Promise(function(n,t){var o=new FileReader;o.onload=function(e){n(e.currentTarget.result)},o.onerror=function(e){t(e)},o.readAsDataURL(e)})}function z(e){m(e).val("")}function E(e){var n=s(e);if(1!==n.length)throw new Error("component must have exactly one .attachDocument element");n.on("click",function(){l(this).find(".filechooser").click()})}function M(e){for(var n=new ArrayBuffer(e.length),t=new Uint8Array(n),o=0,r=e.length;o<r;o++)t[o]=e.charCodeAt(o);return n}function k(e){return f(e).is(":empty")}function L(e){return!(null===e.toLowerCase().match(G.allowedFileTypes)&&""!==e)}function S(e){return void 0===e||e<=G.maxUploadSize}function D(e){return!(G.maxFileNumber&&G.maxFileNumber>0)||p(e).filecount<G.maxFileNumber}function P(e){var n=f(e);n.find(".fileEntry").length===p(e).filecount&&u("onLastFileAdded",e)}function j(n,t){var o=e("<div>").addClass("validationError").text(n);t.find(".uploadErrorMessage").append(o).show()}function B(n){var t=G.maxUploadSize/Math.pow(1024,2),o=Math.floor(10*t)/10,r=e.format(G.errorMessages.sizeExceeded,o);j(r,n)}function O(n){for(var t=G.allowedFileTypes.split("|"),o=[],r=0;r<t.length;r++)o.push(t[r].replace(/\W/g,""));var i=e.format(G.errorMessages.wrongFileType,o.join(", "));j(i,n)}function H(n){var t=e.format(G.errorMessages.tooManyFiles,G.maxFileNumber);j(t,n)}function I(e){j(G.errorMessages.generic,e)}var _=!1,G={labelRemove:"",restrictToOneUpload:!1,maxFileNumber:10,allowedFileTypes:"",maxUploadSize:42949672960,errorMessages:{sizeExceeded:"",wrongFileType:"",tooManyFiles:"",generic:"",security:""},uploadUrl:""},K={onFileAdded:[],onFileRemoved:[],onFirstFileAdded:[y],onLastFileAdded:[],onLastFileRemoved:[v]};return{init:o,configure:t}}(jQuery,cssNamespace.pkportal.restService);