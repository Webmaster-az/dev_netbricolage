cssNamespace.pkportal.policy=function(e,t,o,n){"use strict";function a(e){if(T=e,T.getPolicyUrl){var o={url:T.getPolicyUrl,success:h};t.doPost(o)}var n=t.getParameterFromUrl(window.location.href,"systemMessage");console.info("system message from okp anpassung "+n),i(n)}function i(e){"success"===e&&(console.info("show the message from translate: "+T.successMsg),n.populateSystemMessages([T.successMsg],"successMessageForOKPChange","green"))}function r(o){var n=e(this).attr("class");return t.isBlank(n)?n="":n+=" ",o===!0?n+"buttonShow":n+"buttonHide"}function s(){var o=e(this);if(!N){N=!0;var n=o.attr("class");return t.isBlank(n)?n="":n+=" ",o.attr("href",P.pdfUrl),o.attr("onclick","cssNamespace.tracking.trackCustomDownloadWithCategory(s, this,'"+P.pdfUrl+"', 'Police')"),P.showPdfButton===!0?n+"buttonShow":n+"buttonHide"}o.remove()}function c(e){e.parent().find(".buttonHide").remove()}function l(e,t){var o;t.showVersicherungsDeckungLink===!0&&(o=e.find(".versicherungsDeckungButton"),o.loadTemplate("#versicherungsDeckungButtonTemplate",t,{beforeInsert:function(e){u(t.policyNumber,t.currentPerson,e)}})),t.showVaButton===!0&&(o=e.find(".versicherungDeckungVaButton"),o.loadTemplate("#versicherungDeckungVaButtonTemplate",t,{beforeInsert:function(){m()}}))}function u(t,o,n){w===!0?e(n[0]).attr("disabled","disabled").addClass("beforeTooltip"):d(t,o,n)}function d(e,o,n){n.click(function(){var n={url:T.clearMutatePolicyDataUrl,success:function(){p(e,o)}};t.doPost(n)})}function p(e,t){window.location.href=T.mutatePolicyUrl+"?policyNumber="+e+"&currentPerson="+t}function m(){w===!0?e(".versicherungDeckungVa").attr("disabled","disabled").addClass("beforeTooltip"):f()}function f(){e(".versicherungDeckungVaButton").on("click",function(){var e={url:T.clearVADataUrl,success:y()};t.doPost(e)})}function y(){window.location.href=T.mutatePolicyVaUrl}function v(e,o){var n={data:{policyNumber:o.policyNumber,personNumber:o.personNumber},url:T.checkIsPolicyMutableUrl,success:function(t){l(e,t)}};t.doPost(n)}function h(t){var n=t.currentPolicies;if(w=t.isNikaDown,"undefined"==typeof n||null===n||0===n.length)e("#policyContainer").loadTemplate("#noResultsTemplate",""),e(".printbutton").hide(),e(".detailsPage.policy #policyContainer").css("margin","0"),e(".mainWindow .titletext .padded").hide();else{var a=null;e.each(n,function(t,o){N=!1,P=o,null===a&&(a=o.policyNumber);var n=e(".questionbutton .button").attr("href");e(".questionbutton .button").attr("href",n+"&nid="+a),e("#policyContainer").append("<div id='policy_"+t+"'></div><div id='policyTable_"+t+"'></div>");var i=e("#policy_"+t);i.loadTemplate("#policyInfoTemplate",o,{afterInsert:function(e){c(e),D()}}),v(i,o),e("#policyTable_"+t).loadTemplate("#containerTemplate",o,{afterInsert:c}),o.showOverallTotal===!0&&(e("#policyTable_"+t+">div>div").append("<div id='policyOverall_"+t+"'></div>"),e("#policyOverall_"+t).loadTemplate("#totalTemplate",o))}),e("div#mobileNav.mobile").is(":hidden")&&o.optimizeTablesForReadability("#policyContainer "),m(),b()}}function b(){e("#policyContainer .info .textDetails .detailsRow").each(function(){var o=e(this).find("td:not([class])").text();t.isBlank(o)&&e(this).remove()}),g()}function g(){e("#policyContainer .info .textDetails tr:not([class])").each(function(){e(this).prev().hasClass("detailsRow")&&e(this).next().hasClass("detailsRow")||e(this).remove()})}function k(){return C}var N,T={},P={},w=!1,D=function(){},C=new Promise(function(e){D=e});return e.addTemplateFormatter("cssNamespace.pkportal.policy.hideShowButtonFormatter",r),e.addTemplateFormatter("cssNamespace.pkportal.policy.documentDownloadButtonFormatter",s),{init:a,observePolicyInfoTemplate:k}}(jQuery,cssNamespace.pkportal.utils,cssNamespace.pkportal.styleOptimizer,cssNamespace.pkportal.systemMessage),cssNamespace.pkportal.policyHistory=function(e,t,o,n,a){"use strict";function i(e){v=e,Promise.all([o.observePersonen(),a.observePolicyInfoTemplate()]).then(function(){r()})}function r(){var e=o.getHashByPersonId(o.getCurrentPersonId()),n="vertrag/police/history?userId="+e;t.doRestApiCall(n,"GET","",{}).then(function(e){e.length&&(y=e,l(),s(),c())})}function s(){document.querySelector(d).addEventListener("click",function(){document.querySelector(p).classList.add("-state-hidden"),document.querySelector(m).classList.add("-state-visible"),u(),n.resetCounter()})}function c(){document.querySelector(d).classList.add("-state-visible")}function l(){document.querySelector(".policy-history_current-btn").addEventListener("click",function(){document.querySelector(p).classList.remove("-state-hidden"),document.querySelector(m).classList.remove("-state-visible"),n.resetCounter()})}function u(){e.addTemplateFormatter({dateFomatter:function(e){return moment(e,"YYYY-MM-DD").format("DD.MM.YYYY")},documentLinkFormatter:function(e){var t=f;return e.dokumentNr?t.replace("{1}",[v.downloadDocumentName,e.versichertepersonVornameNachname.replace(/ /g,"_"),e.validFrom.replace(/-/g,""),e.policenNr].join("_")).replace("{2}",e.dokumentNr):void this.remove()}}),e(".policy-history_table tbody").loadTemplate("#policyHistoryRowTemplate",y,{})}var d=".policy-history_button",p="#policyContainer",m=".policy-history_table",f="../../../../secure/pkportal/document.html?documentName={1}&documentId={2}&_charset_=UTF-8",y={},v={downloadDocumentName:""};return{init:i,getPolicyHistory:r}}(jQuery,cssNamespace.pkportal.restService,cssNamespace.pkportal.personenService,cssNamespace.pkportal.keepalive,cssNamespace.pkportal.policy);