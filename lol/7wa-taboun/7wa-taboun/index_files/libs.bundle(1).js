cssNamespace.pkportal.personenService=function(e){"use strict";function t(e){P=e.getPersonsUrl,n()}function n(){function t(e){return i(e),b.notify(e),r(e),e}function n(e){console.log(e)}return new Promise(function(t,n){var r={url:P,success:t,error:n};e.doPost(r)}).then(t,n)}function r(e){var t=e.trackingValues,n=e.mainPerson;window.digitalData=window.digitalData||{},void 0===window.digitalData.agency&&(window.digitalData.agency={agencyInfo:{}}),window.digitalData.agency.agencyInfo.agencyName=t.agencyName,window.digitalData.agency.agencyInfo.agencyMail=t.agencyMail,void 0===window.digitalData.user&&(window.digitalData.user={userInfo:{}}),window.digitalData.user.userInfo.gender=t.gender,window.digitalData.user.userInfo.age=t.age,window.digitalData.user.userInfo.postalCode=t.postalCode,window.digitalData.user.userInfo.chash=n.hash,window.digitalData.user.userInfo.cust="ja",window.digitalData.user.userInfo.mycss="ja"}function o(){return b}function i(e){y=[e.mainPerson].concat(e.otherPersons),a()}function a(){var e=l("current",!0);w=e?e.personid:void 0}function c(e){return l("personid",e)}function s(e){var t=c(e);return!!t&&t.gender}function u(e){var t=c(e);return!!t&&t.firstname+" "+t.lastname}function l(e,t){return d().find(function(n){return n[e]===t})}function p(){return w}function d(){return y}function f(){return d().length}function g(e){var t=c(e);return!!t&&t.hash}function v(){return s(p())}function m(){return u(p())}function h(e){return l("partnerNr",e)}var w,P="",y=[],b=e.createObserver();return{init:t,observePersonen:o,getCurrentPersonId:p,getPersons:d,getPersonsCount:f,getHashByPersonId:g,getGenderOfCurrentPerson:v,getFullnameOfCurrentPerson:m,getPersonByPartnerNr:h}}(cssNamespace.pkportal.utils),cssNamespace.pkportal.profilePictureService=function(e,t,n,r){function o(){e(".button.-state-edit").click(function(){a()}),e(".remove-picture").click(function(){m(r.getCurrentPersonId()).then(function(){t.windowLocationReload()})}),e(".button.-state-upload").click(function(){a()})}function i(e){if(e&&P.find(function(t){return e.startsWith("data:image/"+t)}))return e}function a(){var t=e(".profile-picture-upload-container"),n=400;e.blockUI({message:t,css:{cursor:"inherit",width:n+"px",border:"none",position:"absolute",left:"50%",marginLeft:-1*(n/2)+"px"},overlayCSS:{cursor:"inherit",opacity:.4},onBlock:c()})}function c(){l(),s(),u()}function s(){e(".profile-picture-preview").croppie({viewport:y}),v(r.getCurrentPersonId()).then(function(t){if(t){var n=e(".profile-picture-preview");n.croppie("bind",{url:t}).then(function(){n.croppie("setZoom",-100),g()})}})}function u(){f(),e(".profile-picture-file").on("change",function(){var t={url:"",viewport:y},n=new FileReader;n.onload=function(n){if(f(),t.url=i(n.target.result),t.url){var r=2*t.url.length/3;r<=3145728?(e(".profile-picture-preview").croppie("destroy"),e(".profile-picture-preview").croppie(t),g()):d("error.tooBig")}else d("error.format")},n.readAsDataURL(this.files[0])})}function l(){window.setTimeout(function(){e(".blockUI.blockOverlay, .profile-picture-upload-abort, .profile-picture-upload-container .close-X").click(function(e){p()})},100)}function p(){e.unblockUI(),e(".profile-picture-preview").croppie("destroy")}function d(t){e(".profile-picture-upload-form-error [data-msgtype='"+t+"'].validationError").show()}function f(){e(".profile-picture-upload-form-error .validationError").hide()}function g(){e(".profile-picture-upload-save").removeAttr("disabled").click(function(){e(".profile-picture-preview").croppie("result",{type:"canvas",size:{width:800,height:800},format:"jpeg",quality:"0.9",circle:!1}).then(function(e){w(r.getCurrentPersonId(),e).then(function(e){e?p():d("error.save")})})})}function v(e){var t="account/foto?versichertePersonUserId="+r.getHashByPersonId(e);return n.doRestApiCall(t,"GET",null,{dataType:"binary",headersAccept:"*/*"}).then(function(e){if(e&&e.size){var t=window.URL.createObjectURL(e);return t}return!1},function(e){return!1})["catch"](function(e){return!1})}function m(e){var t="account/foto?versichertePersonUserId="+r.getHashByPersonId(e);return n.doRestApiCall(t,"DELETE").then(function(e){return!0},function(e){return!1})["catch"](function(e){return!1})}function h(e){for(var t=new ArrayBuffer(e.length),n=new Uint8Array(t),r=0,o=e.length;r<o;r++)n[r]=e.charCodeAt(r);return t}function w(e,o){var i="account/foto/pdf?versichertePersonUserId="+r.getHashByPersonId(e),a=o.substring("data:image/jpeg;base64,".length),c=atob(a),s=h(c),u=new FormData,l=new Blob([s],{type:"image/jpeg"});return u.append("image",l),n.doRestApiCall(i,"POST",u,{processData:!1}).then(function(e){return(!e||!e.error)&&(t.windowLocationReload(),!0)},function(e){return!1})["catch"](function(e){return!1})}var P=["bmp","gif","jpg","jpeg","png"],y={width:100,height:100,type:"circle"};return{getProfilePicture:v,addProfilePictureButtonEvents:o}}(jQuery,cssNamespace.pkportal.utils,cssNamespace.pkportal.restService,cssNamespace.pkportal.personenService),cssNamespace.pkportal.familyview=function(e,t,n,r){"use strict";function o(e){y=e;var t=n.observePersonen().then(function(){P=n.getPersonsCount(),i(),t()})}function i(){var t=n.getPersons();t[0].allowed=!0,e(".family-container").loadTemplate("#personTemplate",t,{beforeInsert:c,afterInsert:s}),l(),a()}function a(){var t=e(".family-container.mobile"),n=e(".family-member-dropdown"),r=t.find(".current").children().clone();n.append(r),t.length>0&&(n.on("click",function(){e(this).hasClass("active")?(t.stop().slideUp(500),e(this).removeClass("active")):(t.stop().slideDown(500),e(this).addClass("active"))}),n.find(".dropdown-icon").css("display","block"))}function c(e){e.data("current")&&e.addClass("current"),e.data("allowed")||e.find("button").prop("disabled",!0)}function s(t){var n=t.find("button");t.find(".profile-picture");r.getProfilePicture(n.data("personid")).then(function(t){var r=e("button[data-personid="+n.data("personid")+"] span.profile-picture");t?r.addClass("-state-has-profile-picture").append('<img src="'+t+'" alt=""/>'):r.addClass("-state-"+r.data("gender"))})}function u(t){t.preventDefault();var n=e(this).data("personid");m(n).then(function(){d()})}function l(){e(".family-container li").each(function(){var t=e(this);t.data("allowed")?t.find("button").on("click",u):p(t)})}function p(t){var n={content:y.personDisabledTooltipText,style:{classes:"qtip-tipsy"},position:{my:"left center",at:"right center",adjust:{x:20},viewport:e(window)}},r=t.parents(".family-container").hasClass("mobile");r&&(n.position.my="top left",n.position.at="middle left"),t.qtip(n)}function d(){var e=y.redirectUrl.trim();void 0!==e&&e.length>0||g(t.getWindowLocation().href)?f(e):v()}function f(e){e=t.makeAEMUrl(e),t.windowLocationHref(e)}function g(e){return new RegExp(/.htm(l?)\/(?=.*[\w])/g).test(e)}function v(){var e=t.getWindowLocation().href;e=t.removeAngularParameters(e),t.windowLocationHref(e),t.windowLocationReload()}function m(e){return new Promise(function(n,r){var o={url:y.selectPersonUrl,data:{personId:e},success:n,error:r};t.doPost(o)})}function h(e){var t=n.getPersonByPartnerNr(e);return w(t.personid)}function w(e){var t=n.getCurrentPersonId();return t!==e?m(e,!1):Promise.resolve()}function P(){return P}var P,y={};return{init:o,updateFamilyView:w,updateFamilyViewByPartnerNr:h,numberOfPersons:P}}(jQuery,cssNamespace.pkportal.utils,cssNamespace.pkportal.personenService,cssNamespace.pkportal.profilePictureService),cssNamespace.pkportal.myData=cssNamespace.pkportal.myData||{},cssNamespace.pkportal.myData.personalInfo=function(e,t,n,r){"use strict";function o(e){d(e.dataContainer,e.containerId,e.resourcePath),f()}function i(t){t.find(".row").each(function(t,n){var r=e(n).find(".value");r.length>0&&r.text().length<1&&(e(n).next(".dottedLine.horizontal").remove(),e(n).remove())}),t.find(".row").last().next(".dottedLine.horizontal").remove()}function a(){e.addTemplateFormatter({appendices:function(e,t){return e.join("<br/>")}})}function c(){e.addTemplateFormatter({anbieter:function(e,t){return e.join(", ")}})}function s(e){e.prevAll(".button").show()}function u(e){e.prevAll(".hintMessage").show()}function l(e,t){e.prevAll(".button").text(t)}function p(e){e.parent(".personalInformation").hide()}function d(e,n,r){var o={url:r,success:function(t){e.loadTemplate(n,t.data,{afterInsert:i}),void 0!==t.alterButtonTextTo&&t.alterButtonTextTo&&l(e,t.alterButtonTextTo),void 0!==t.showButton&&t.showButton&&s(e),void 0!==t.showHintMessage&&t.showHintMessage&&u(e),void 0!==t.hideComponent&&t.hideComponent&&p(e)}};t.doPost(o)}function f(){var t=e(".profile-picture-container"),o=n.observePersonen().then(function(){r.getProfilePicture(n.getCurrentPersonId()).then(function(o){o?(t.addClass("-state-has-profile-picture"),e(".profile-picture",t).addClass("-state-has-profile-picture").append('<img src="'+o+'" alt=""/>')):(e(".profile-picture",t).addClass("-state-"+n.getGenderOfCurrentPerson()),t.addClass("-state-has-no-profile-picture")),r.addProfilePictureButtonEvents()}),o()})}return{init:o,populateFromTemplate:d,loadAddressFormatters:a,loadAccountFormatters:c}}(jQuery,cssNamespace.pkportal.utils,cssNamespace.pkportal.personenService,cssNamespace.pkportal.profilePictureService);