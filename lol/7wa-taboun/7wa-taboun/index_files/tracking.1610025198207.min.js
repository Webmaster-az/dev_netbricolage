if (typeof(s) === 'undefined') {
	s = {};
	s.t = function(){};
	s.tl = function(){};
}
if (typeof(_satellite) === 'undefined') {
	_satellite = {};
	_satellite.pageBottom = function(){};
	_satellite.track = function(){};
}
var dataLayer = {
    pageInfo: {
        server: "",
        pageName: "",
        pageType: "",
        channel: "",
        pageURL: "",
        pageTitle: "",
        siteSections: "",
        siteSubSection: "",
        language: "",
        contactName: "",
        contactStep: "",
        trackingId: "",
        campaignId: "",
        websiteId: "",
        bannerId: "",
        application: ""
    },
    userInfo: {
        userAgent: "",
        postalCode: "",
        gender: "",
        yearOfBirth: ""
    },
    event: {
        eventList: ""
    },
    additionalInfo: {
        agentur: {
            type: "",
            searchAgenturNr: "",
            searchMitarbeiterNr: "",
            searchName: ""
        },
        praemienrechner: {
            clientId: "",
            productList: "",
            riskZone: "",
            prevInsurer: "",
            accidentCover: "",
            franchise: "",
            numOfAdults: "",
            numOfChildren: "",
            policycost: "",
            orderId: "",
            existingCustomer: "",
            calculatorName: "",
            calculatorStep: ""
        },
        search: {
            searchWord: "",
            numSearchResults: "",
            searchType: ""
        },
        lerb: {
            mannequinbereich: "",
            fachbereich: "",
            fachbereichInput: "",
            ort: "",
            ortInput: "",
            spitalid: "",
            vergleichsListe: ""
        },
        frv: {
            selectedPackage: "",
            insuredPersons: null,
            daysBeforeStart: null,
            contractDuration: null,
            valuta: null,
            postalCode: null,
            gender: "",
            yearOfBirth: null,
            paymentType: "",
            opportunityNum: "",
            totalCost: null,
            productList: null,
            errors: null
        },
        puma: {
            numOfAdults: null,
            numOfChildren: null,
            numOfUnborn: null,
            familyDiscount: null,
            contractDuration: null,
            totalCost: null,
            riskZone: null,
            productList: "",
            insuredPerson: null,
            valuta: null,
            opportunityNum: null,
            entryDate: null,
            valutaFix: null,
            tarifGenehmigt: null,
            tarifGenehmigtBis: null
        }
    }
};

var cssNamespace = cssNamespace || {};

cssNamespace.Class = function () {
};

cssNamespace.tracking = function () {
    return {
        // track custom action
        trackCustomLinkAction: function (appName, stepName, actionName, desc, s, language) {
            if (s == null) {
                s = window.s;
            }
            var toTrack = appName + ":";
            if (stepName != null && stepName.length > 0) {
                toTrack += stepName + ":";
            }
            if (language == null) {
                language = dataLayer.pageInfo.language;
            }
            toTrack += language;
            toTrack += ":" + actionName;
            toTrack += ":" + desc;
            if (s != null && appName && desc && cssNamespace.tracking.ON === 'on') {
                s.linkTrackVars = "None";
                s.linkTrackEvents = "None";
                s.tl(true, 'o', toTrack);
            }
            if (dataLayer != null) {
                console.log('dtm_trackCustomLinkAction');
                _satellite.track('dtm_trackCustomLinkAction');
            }
        },
        trackCustomEvent: function (event, clientId) {
            if (clientId == null) {
                clientId = dataLayer.additionalInfo.praemienrechner.clientId;
            }
            if (s != null && cssNamespace.tracking.ON === 'on') {
                s.events = event + ':' + clientId;
                s.purchaseID = '';
                s.products = '';
                var s_code = s.t();
                if (s_code) {
                    document.write(s_code);
                }
            }
            if (dataLayer != null) {
                dataLayer.event.eventList = event + ':' + clientId;
                console.log('dtm_trackCustomEvent');
                _satellite.track('dtm_trackCustomEvent');
            }
        },
        trackCustomPage: function (customPageName, customEvents, trackingId) {
            if (s != null && cssNamespace.tracking.ON === 'on') {
                s.pageName = customPageName;
                if (customEvents != null) {
                    events = "event7," + customEvents;
                    s.events = events;

                }
                if (trackingId != null && trackingId.length > 0) {
                    s.campaign = trackingId;
                    s.purchaseID = '';
                    s.products = '';
                    var s_code = s.t();
                    if (s_code) {
                        document.write(s_code);
                    }
                }
            }
            if (dataLayer != null) {
                dataLayer.pageInfo.pageName = customPageName;
                if (customEvents != null) {
                    events = "event7," + customEvents;
                    dataLayer.event.eventList = events;
                }
                if (trackingId != null && trackingId.length > 0) {
                    dataLayer.pageInfo.campaign = trackingId;
                }
                console.log('dtm_trackCustomPage');
                _satellite.track('dtm_trackCustomPage');
            }
        },
        trackAccordionAction: function (accName, trackingAcordionAction, language, pageTitle) {
            if (language == null) {
                language = dataLayer.pageInfo.language;
            }
            if (pageTitle == null) {
                pageTitle = dataLayer.pageInfo.pageName;
            }
            var toTrack = trackingAcordionAction;
            toTrack += ":" + language;
            toTrack += ":" + pageTitle;
            toTrack += ":" + accName;
            cssNamespace.tracking.trackActionInternal(s, toTrack);
        },
        trackTabAction: function (tabName, trackingTabAction, language, pageTitle) {
            if (trackingTabAction == null) {
                trackingTabAction = "TAB";
            }
            if (language == null) {
                language = dataLayer.pageInfo.language;
            }
            if (pageTitle == null) {
                pageTitle = dataLayer.pageInfo.pageName;
            }
            var toTrack = trackingTabAction;
            toTrack += ":" + language;
            toTrack += ":" + pageTitle;
            toTrack += ":" + tabName;
            cssNamespace.tracking.trackActionInternal(s, toTrack);
        },
        trackInfoPopupAction: function (infoName, trackingPopupAction, language) {
            if (trackingPopupAction == null) {
                trackingPopupAction = "INFO";
            }
            if (language == null) {
                language = dataLayer.pageInfo.language;
            }
            var toTrack = trackingPopupAction;
            toTrack += ":" + language;
            toTrack += ":" + s.pageName;
            toTrack += ":" + infoName;
            cssNamespace.tracking.trackActionInternal(s, toTrack);
        },
        trackCustomBenachrichtigungHistoryLink: function (s, notificationType) {
            var toTrack = "trackingHistoryLinkAction : " + notificationType;
            cssNamespace.tracking.trackActionInternal(s, toTrack);
        },
        trackCustomBenachrichtigungHistoryDropbox: function (s) {
            var toTrack = "trackingHistoryDropboxAction";
            cssNamespace.tracking.trackActionInternal(s, toTrack);
        },
        trackActionInternal: function (s, toTrack) {
            if (cssNamespace.tracking.ON === 'on') {
                s.linkTrackVars = "None";
                s.linkTrackEvents = "None";
                s.tl(true, 'o', toTrack);
            }
            if (dataLayer != null) {
                console.log('dtm_trackActionInternal');
                _satellite.track('dtm_trackActionInternal');
            }
        },
        trackCustomDownload: function (s, obj, href) {
            if (cssNamespace.tracking.ON === 'on') {
                href = trimParameter(href, 100);
                s.linkTrackVars = "None";
                s.linkTrackEvents = "None";
                var lt = href !== "" ? href : "undefined";
                s.tl(obj, 'd', lt);
            }
            if (dataLayer != null) {
                console.log('dtm_trackCustomDownload');
                _satellite.track('dtm_trackCustomDownload');
            }

            // Tracking 2.0
            var event = new CustomEvent('event-action-trigger', {
                detail: {
                    eventCategory: 'downloads',
                    eventAction: 'download',
                    eventLabel: href
                }
            });
            document.body.dispatchEvent(event);
        },
        trackCustomDownloadWithCategory: function (s, obj, href, category) {
            href = trimParameter(href, 80);

            if (cssNamespace.tracking.ON === 'on') {
                var toTrack = 'PersonalDocuments: ' + category;
                cssNamespace.tracking.trackActionInternal(s, toTrack);
            }
            if (dataLayer != null) {
                _satellite.track('dtm_trackCustomDownloadWithCategory');
            }

            // Tracking 2.0
            var event = new CustomEvent('event-action-trigger', {
                detail: {
                    eventCategory: 'downloads',
                    eventAction: 'download',
                    eventLabel: href
                }
            });
            document.body.dispatchEvent(event);
        },
        setNumberResults: function (s, numberResults) {
            var formattedResult;
            if (parseInt(numberResults) > 0) {
                formattedResult = numberResults;
            } else {
                formattedResult = "Kein Suchergebnis";
            }

            if (s != null && cssNamespace.tracking.ON === 'on') {
                s.prop7 = formattedResult;
            }

            // tracking 2.0
            window.digitalData = window.digitalData || {};
            window.digitalData.search = window.digitalData.search || { searchInfo: {}};
            window.digitalData.search.searchInfo.result = formattedResult;

            var count = window.digitalData.search.searchInfo.count;
            window.digitalData.search.searchInfo.count = count ? count + 1 : 1;

            new CustomEvent('event-search-trigger', {
                'detail': window.digitalData.search.searchInfo
            });
        },
        setSearchResultsCriteria: function (s, searchWord, searchType) {
            if (s != null && cssNamespace.tracking.ON === 'on') {
                s.prop5 = searchWord;
                s.prop6 = searchType;
                // send event 19
                cssNamespace.tracking.setEvent(s, "event19");
                var s_code = s.t();
                if (s_code) {
                    document.write(s_code);
                }

            }

            // tracking 2.0
            window.digitalData = window.digitalData || {};
            window.digitalData.search = window.digitalData.search || { searchInfo: {}};

            window.digitalData.search.searchInfo.term = searchWord;
            window.digitalData.search.searchInfo.type = searchType;
        },
        setEvent: function (s, event) {
            console.log('setEvent');
            if (s != null && cssNamespace.tracking.ON === 'on') {
                if (s.events == undefined || s.events == "") {
                    s.events = event;
                } else {
                    var exists = false;
                    var a = s.events.split(",");

                    for (var i = 0; i < a.length; i++) {
                        var t = a[i];

                        if (t == event) {
                            exists = true;
                            break;
                        }
                    }

                    if (!exists) {
                        s.events += "," + event;
                    }

                }
            }
            if (dataLayer != null) {
                var exists = false;
                var a = dataLayer.event.eventList.split(",");

                for (var i = 0; i < a.length; i++) {
                    var t = a[i];

                    if (t == event) {
                        exists = true;
                        break;
                    }
                }

                if (!exists) {
                    dataLayer.event.eventList += "," + event;
                }
            }
        },
        setPurchaseID: function (s, newval) {
            if (s != null && cssNamespace.tracking.ON === 'on') {
                s.purchaseId = newval;
            }
            if (dataLayer != null) {
                dataLayer.additionalInfo.praemienrechner.orderId = newval;
            }
        },
        setEvent: function (s, newval) {
            if (s != null && cssNamespace.tracking.ON === 'on') {
                s.events = newval;
            }
            if (dataLayer != null) {
                dataLayer.event.eventList = newval;
            }
        },
        setProducts: function (s, newval) {
            if (s != null && cssNamespace.tracking.ON === 'on') {
                s.products = newval;
            }
            if (dataLayer != null) {
                dataLayer.additionalInfo.praemienrechner.productList = newval;
            }
        },
        getContatenatedQueryField: function (container, spanClass) {
            var findLi = "." + spanClass + " li";
            var $obj = $(container).find(findLi);
            var q = "";
            $.each($obj, function (i, val) {
                var v = $(val).text().trim();
                if (q.length == 0) {
                    q += v;
                } else {
                    q += "_" + v;
                }
            });

            return q;
        },
        getConcatenatedStrings: function (str1, str2) {
            if (str1 == "" && str2 == "") {
                return "";
            } else {
                if (str1 != "" && str2 == "") {
                    return str1;

                } else {
                    if (str1 == "" && str2 != "") {
                        return str2;
                    } else {
                        return str1 + "-" + str2;
                    }
                }
            }
        },
        setSearchEvent: function (s) {
            cssNamespace.tracking.setEvent(s, "event19");
        },
        setSearchLexicon: function (s) {
            var $tab = $("#tabs-");
            var textSelectedTab = $tab.find(".ui-tabs-selected").text();
            var queryString = $tab.find(".cssch_suchtext").val();
            var searchType = "Gesundheitslexikon" + "-" + textSelectedTab;

            cssNamespace.tracking.setSearchResultsCriteria(s, queryString, searchType);
        },
        setAgenturTracking: function (s) {
            $("#agency_finder_form").submit(function () {
                var val = $(this).find("input[name=plz]").val();
                cssNamespace.tracking.setSearchResultsCriteria(s, val, "Agenturen");
                return true;
            });
        }
    };
}();

/***
 *    function trimPageName for Sitecatalyst tracking
 *  1) reduces the levels to 'levels' with just taking the first four and the last two levels
 *        e.g.: /de/level2/level3/level4/level5/level6/pageonlevel7 --> /de/level2/level3/level4/../level6/pageonlevel7
 *  2) trims the path to max 'length' with trimming the start of the path and starting with /../path
 *
 * function trimParameter for Sitecatalyst tracking
 *  1) trims the parameter to max 'length' with trimming the start of the parameter and starting with /..parameter
 *
 ***/

function trimPageName(path, levels, length) {
    // jshint strict: false
    var newPath = path;
    if (path && path.indexOf("/") === 0) {
        var maxLength = (length !== null && length > 0) ? length : 100;
        var maxLevels = (levels !== null && levels > 0) ? levels : 6;

        var helper = path.split("/");
        if (helper.length > maxLevels + 1) {
            newPath = helper.slice(0, 5).concat([".."]).concat(helper.slice(helper.length - 2)).join("/");
        }
        if (newPath.length > maxLength) {
            newPath = "/../" + newPath.substr(newPath.length - maxLength + 4);
        }
    }
    return newPath;
}

function trimParameter(parameter, length) {
    // jshint strict: false
    var newParameter = parameter;
    var maxLength = (length !== null && length > 0) ? length : 100;

    if (newParameter.length > maxLength) {
        newParameter = "/.." + newParameter.slice(-97);
    }
    return newParameter;
}

